<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:BestPerfume"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             Shell.NavBarIsVisible="False"
             x:Class="BestPerfume.Catalogue"
             x:DataType="local:PerfumeViewModel">

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:BoolToOpacityConverter x:Key="BoolToOpacityConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*">
        <HorizontalStackLayout Grid.Row="0" Padding="10" Spacing="10">
            <Button Text="Select Filters"
                    MinimumHeightRequest="30"
                    Padding="10,0,10,0"
                    Clicked="ShowFilterPopup"/>
        </HorizontalStackLayout>
        <CollectionView Grid.Row="1" ItemsSource="{Binding DisplayedPerfumes}">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical"
                                 Span="{Binding Span}" />
            </CollectionView.ItemsLayout>
            
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="local:Perfume">
                    <Grid Padding="10"
                      ColumnDefinitions="Auto, *"
                      RowDefinitions="Auto, Auto">

                        <!-- ID (big font, left column, spanning both rows) -->
                        <Label Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                               Text="❤️"
                               VerticalOptions="Center"
                               FontSize="36"
                               TextColor="DarkRed"
                               HorizontalOptions="Center"
                               Opacity="{Binding Favourited, Converter={StaticResource BoolToOpacityConverter}}"
                               Margin="0,0,10,0" />
                        <Label Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                               Text="{Binding ID}"
                               VerticalOptions="Center"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               Margin="0,0,10,0" />

                        <!-- Main Accords (top row, middle column) -->
                        <StackLayout Grid.Row="0" Grid.Column="1"
                                 Orientation="Horizontal"
                                 Spacing="4"
                                 HorizontalOptions="Start"
                                 VerticalOptions="Center"
                                 BindableLayout.ItemsSource="{Binding Accords}">
                            <BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="local:Accord">
                                    <Border StrokeShape="RoundRectangle 20"
                                        BackgroundColor="{Binding BackgroundColour}"
                                        StrokeThickness="0"
                                        Padding="6,2"
                                        VerticalOptions="Center">
                                        <Label Text="{Binding Name}"
                                           FontSize="12"
                                           TextColor="{Binding TextColour}"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center" />
                                    </Border>
                                </DataTemplate>
                            </BindableLayout.ItemTemplate>
                        </StackLayout>

                        <!-- Perfume Name (bottom row, middle column) -->
                        <Label Grid.Row="1" Grid.Column="1"
                               Text="{Binding Name}"
                               FontSize="14"
                               Padding="0,0,5,0"
                               HorizontalOptions="Start"
                               VerticalOptions="Center" />

                        <!-- Overlay Button -->
                        <Button Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Grid.ColumnSpan="2"
                            Text=""
                            BackgroundColor="Transparent"
                            Clicked="OnOptionsClicked"
                            CommandParameter="{Binding .}"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>

</ContentPage>
